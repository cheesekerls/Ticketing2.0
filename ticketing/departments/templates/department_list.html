{% extends "base_superadmin.html" %}

{% block title %}Departments{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Departments</h2>

<table border="1" width="100%" style="border-collapse: collapse;">
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Prefix</th>
        <th>Action</th>
    </tr>
    {% for dept in departments %}
    <tr>
        <td>{{ dept.department_id }}</td>
        <td>{{ dept.department_name }}</td>
        <td>{{ dept.prefix }}</td>
        <td>
            <button onclick="openEditModal('{{ dept.department_id }}', '{{ dept.department_name }}', '{{ dept.prefix }}')">Edit</button>
            <button onclick="confirmDelete('{{ dept.department_id }}')">Delete</button>
        </td>
    </tr>
    {% empty %}
    <tr><td colspan="4">No departments found.</td></tr>
    {% endfor %}
</table>

<br>
<a href="{% url 'add_department' %}">+ Add Department</a>

<!-- ðŸ§  Edit Modal -->
<div id="editModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.6); justify-content:center; align-items:center;">
    <div style="background:white; padding:20px; border-radius:10px; width:400px;">
        <h3>Edit Department</h3>
        <form id="editForm" method="post" action="{% url 'update_department' %}">
            {% csrf_token %}
            <input type="hidden" id="edit_id" name="department_id">
            <label>Name:</label><br>
            <input type="text" id="edit_name" name="department_name" required><br><br>
            <label>Prefix:</label><br>
            <input type="text" id="edit_prefix" name="prefix" required><br><br>
            <button type="submit">Save</button>
            <button type="button" onclick="closeEditModal()">Cancel</button>
        </form>
    </div>
</div>

<script>
// ðŸ§  Show edit modal
function openEditModal(id, name, prefix) {
    document.getElementById('editModal').style.display = 'flex';
    document.getElementById('edit_id').value = id;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_prefix').value = prefix;
}

// ðŸ§  Close modal
function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

// ðŸ§  Delete confirmation
function confirmDelete(id) {
    Swal.fire({
        title: 'Are you sure?',
        text: "This action cannot be undone!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = '/departments/delete/' + id + '/';
        }
    });
}
</script>

</body>
</html>
{% endblock %}
